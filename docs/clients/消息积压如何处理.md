## 消息积压的直接原因
系统中的某部分出现了性能问题，来不及处理上游发送的消息，导致消息堆积
## 优化性能避免消息积压
### producer 性能优化
producer 端发送消息的时延
发送网络请求之前的耗时：producer准备数据 序列化消息 构造请求
发送消息与返回响应在网络传输中的耗时
broker处理时延的耗时
### consumer 性能优化
使用消息队列的时候，大部分问题都出现在consumer ，如果consumer消费的速度跟不上producer 生产的速度
就会造成消息积压。所以我们在设计系统的时候，一定要保证consumer的消费性能要高于producer 的生产性能。

consumer的性能优化除了优化消费的业务逻辑，也可以通过水平扩容，增加consumer的并发数提高整体的消费性能
## 消息堆积了如何处理
导致消息堆积的原因多种多样，不同的系统，不同的情况由不同的原因，不能一概而论。但是，我们排查消息挤压原因
，是有一些相对固定且比较有效的方法。
大部分消息队列，都内置监控功能，只要通过监控数据，很容易确定那种原因，如果是单位时间内发送的消息增多，比如
赶上大促或者限购，短时间不太可能优化消费端的代码提升消费性能，唯一的方法是通过扩容消费端的实例来提升总体的消费能力
。如果短时间内没有足够的服务器资源进行扩容，可以将系统降级，通过关闭一些不重要的业务，减少发送方发送的消息量
，最低限度让系统正常运转，服务一些重要的业务。